events {
    worker_connections 1024;
}

http {
    upstream backend {
        server backend:8000;
    }

    # Local development server - Ana port
    server {
        listen 80;
        server_name localhost;

        # API isteklerini backend'e yÃ¶nlendir
        location /api {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # GTFS dosyalarÄ± iÃ§in bÃ¼yÃ¼k upload boyutu
            client_max_body_size 100M;
        }

        # Docs ve health check
        location /docs {
            proxy_pass http://backend/docs;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /openapi.json {
            proxy_pass http://backend/openapi.json;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Ana sayfa - basit info sayfasÄ±
        location / {
            return 200 '<!DOCTYPE html>
<html>
<head>
    <title>GTFS Backend - Local Development</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .endpoint { background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid #007bff; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸšŒ GTFS Backend API - Local Development</h1>
        <p>Backend servisiniz baÅŸarÄ±yla Ã§alÄ±ÅŸÄ±yor!</p>
        
        <h2>ðŸ“‹ Mevcut Endpoints:</h2>
        <div class="endpoint">
            <strong>API Documentation:</strong> <a href="/docs" target="_blank">http://localhost/docs</a>
        </div>
        <div class="endpoint">
            <strong>Health Check:</strong> <a href="/api/health" target="_blank">http://localhost/api/health</a>
        </div>
        
        <h2>ðŸ”§ Development Info:</h2>
        <ul>
            <li><strong>Nginx Port:</strong> 80 (bu sayfa)</li>
            <li><strong>Direct API Port:</strong> 8080 (nginx bypass)</li>
            <li><strong>Database Port:</strong> 5432</li>
        </ul>
    </div>
</body>
</html>';
            add_header Content-Type text/html;
        }
    }

    # Direct backend access port (bypass nginx)
    server {
        listen 8080;
        server_name localhost;

        location / {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }
}